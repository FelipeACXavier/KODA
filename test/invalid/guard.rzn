async task Drive(float x, float y) {
  trigger: void to_position(float x, float y):
    topic: "/topic" "std_msgs::msg::String";
  
  abort: void abort():
    service: "/abort" "std_msgs::msg::String";

  return: void in_position(float x, float y):
    topic: "/reply" "std_msgs::msg::String";
    
  error: void path_blocked();
}

sync task Siren() {
  accepts {
    void start():
      service: "/siren_start" "std_msgs::SirenControl" ;
    void stop():
      service: "/siren_stop" "std_msgs::SirenControl" ;
  }
}

sync task Weather() {
  accepts {
    bool check();
  }
}

task component Patrol (drive req Drive, siren req Siren, weather req Weather,
                       float x1, float y1, float x2, float y2) {
  trigger: void start(float x1, float y1, float x2, float y2);
  abort: void abort();
  error: void failed();

  vars {
    float x1_ = x1 : 0.0
    float y1_ = y1 : 0.0
    float x2_ = x2 : 0.0
    float y2_ = y2 : 0.0
  }

  strategy {
    err: siren.start() --> let a = weather.check() --> guard { a } --> end;
    main: siren.stop() --> repeat(
      (drive(x1_, y1_) on error err on abort end) -->
      (drive(x2_, y2_) on error err on abort end));
  }
}
