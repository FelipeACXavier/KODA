async task Drive(float x, float y) {
  trigger: void to_position(float x, float y):
    action: "/navigate_to_pose" "NavigateToPose::Goal";
  
  abort: void abort():
    action: "/navigate_to_pose" "abort";

  return: void in_position(float x, float y):
    action: "/navigate_to_pose" "success";
    
  error: void path_blocked():
    action: "/navigate_to_pose" "failed";
}

sync task Siren() {
  accepts {
    void start():
      service: "/siren_start" "std_msgs::SirenControl" ;
    void stop():
      service: "/siren_stop" "std_msgs::SirenControl" ;
  }
}

task component Patrol (drive req Drive, siren req Siren,
                       float x1, float y1, float x2, float y2) {
  trigger: void start(float x1, float y1, float x2, float y2);
  abort: void abort();
  error: void failed();

  vars {
    float x1_ = x1 : 0.0
    float y1_ = y1 : 0.0
    float x2_ = x2 : 0.0
    float y2_ = y2 : 0.0
  }

  strategy {
    err: siren.start() --> end;
    main: siren.stop() --> repeat(
      (drive(x1_, y1_) on error err on abort end) --> (drive(x2_, y2_) on error err on abort end));
  }
}
